{% extends 'base.html' %}
{% block title %}Projects - Aynekulu{% endblock %}
{% block content %}

<!-- Filters Section -->
<section class="py-3 bg-light">
  <div class="container">
    <h5 class="text-center mb-3">Filter Projects</h5>
    <div class="text-center">
      <button class="btn btn-outline-primary me-2 filter-btn" data-filter="all">All</button>
      <button class="btn btn-outline-primary me-2 filter-btn" data-filter="data-science">Data Science</button>
      <button class="btn btn-outline-primary me-2 filter-btn" data-filter="full-stack">Full Stack</button>
      <button class="btn btn-outline-primary filter-btn" data-filter="ml-ai">ML/AI</button>
    </div>
  </div>
</section>

<section id="projects" class="py-5">
  <div class="container">
    <h2 class="text-center mb-5">My Projects</h2>
    <div class="row g-4 project-grid">
      {% for project in projects %}
      <div class="col-lg-4 col-md-6 project-item {% if 'COVID' in project.title %}data-science{% elif 'E-Commerce' in project.title %}full-stack{% elif 'Chatbot' in project.title %}ml-ai{% endif %}">
        <div class="card h-100 shadow-sm project-card" data-bs-toggle="modal" data-bs-target="#projectModal{{ forloop.counter }}">
          <img src="{{ project.image.url }}" class="card-img-top" alt="{{ project.title }}" loading="lazy">
          <div class="card-body">
            <h5 class="card-title">{{ project.title }}</h5>
            <p class="card-text">{{ project.description|truncatewords:15 }}</p>
            <div class="d-flex justify-content-between mt-3">
              {% if project.github_url %}
              <a href="{{ project.github_url }}" target="_blank" class="btn btn-outline-dark btn-sm">GitHub</a>
              {% endif %}
              {% if project.demo_url %}
              <a href="{{ project.demo_url }}" target="_blank" class="btn btn-primary btn-sm">Live Demo</a>
              {% endif %}
            </div>
          </div>
        </div>
      </div>

      <!-- Modal for Project Details -->
      <div class="modal fade" id="projectModal{{ forloop.counter }}" tabindex="-1" aria-labelledby="projectModalLabel{{ forloop.counter }}" aria-hidden="true">
        <div class="modal-dialog modal-lg">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="projectModalLabel{{ forloop.counter }}">{{ project.title }}</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <img src="{{ project.image.url }}" class="img-fluid mb-3" alt="{{ project.title }}" loading="lazy">
              <p>{{ project.description }}</p>
              <strong>Technologies:</strong> {% if 'COVID' in project.title %}Python, Pandas, Matplotlib, Seaborn{% elif 'E-Commerce' in project.title %}Django, React, Bootstrap{% elif 'Chatbot' in project.title %}Python, TensorFlow, NLTK{% else %}Various{% endif %}<br>
              {% if project.github_url %}<strong>GitHub:</strong> <a href="{{ project.github_url }}" target="_blank">{{ project.github_url }}</a><br>{% endif %}
              {% if project.demo_url %}<strong>Demo:</strong> <a href="{{ project.demo_url }}" target="_blank">{{ project.demo_url }}</a>{% endif %}
              <!-- Sample Chart for COVID Project -->
              {% if 'COVID' in project.title %}
              <div style="height: 300px; margin: 20px 0;">
                <canvas id="correlationChart{{ forloop.counter }}"></canvas>
                <script>
                  const ctx{{ forloop.counter }} = document.getElementById('correlationChart{{ forloop.counter }}').getContext('2d');
                  new Chart(ctx{{ forloop.counter }}, {
                    type: 'scatter',
                    data: {
                      datasets: [{
                        label: 'Correlation Heatmap (Sample)',
                        data: [
                          { x: 'total_cases', y: 0.95 },
                          { x: 'total_deaths', y: 0.85 },
                          { x: 'new_cases', y: 0.80 },
                          { x: 'total_vaccinations', y: 0.90 }
                        ],
                        backgroundColor: 'rgba(0, 123, 255, 0.6)',
                        pointRadius: 10
                      }]
                    },
                    options: {
                      scales: { x: { title: { display: true, text: 'Metrics' } }, y: { title: { display: true, text: 'Correlation' } } },
                      plugins: { legend: { display: false } }
                    }
                  });
                </script>
              </div>
              {% endif %}
            </div>
          </div>
        </div>
      </div>
      {% empty %}
      <div class="col-12 text-center">
        <p class="text-muted">No projects yetâ€”add some from the admin panel!</p>
      </div>
      {% endfor %}
    </div>
  </div>
</section>

<style>
  .project-grid {
    transition: all 0.3s ease;
  }
  .project-item {
    opacity: 1;
    transition: opacity 0.5s ease;
  }
  .project-item.hidden {
    opacity: 0;
    transform: translateY(20px);
  }
  .filter-btn.active {
    background-color: var(--primary);
    color: var(--text-light);
  }
  .project-card {
    transition: transform 0.3s ease;
  }
  .project-card:hover {
    transform: translateY(-5px);
  }
</style>

<script>
  // Filter functionality with URL query support
  document.querySelectorAll('.filter-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      const filter = btn.dataset.filter;
      window.history.pushState({}, '', `?filter=${filter}`);
      document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      filterProjects(filter);
    });
  });

  function filterProjects(filter) {
    document.querySelectorAll('.project-item').forEach(item => {
      if (filter === 'all' || item.classList.contains(filter)) {
        item.style.display = 'block';
        setTimeout(() => item.classList.remove('hidden'), 50);
      } else {
        item.classList.add('hidden');
        setTimeout(() => item.style.display = 'none', 500);
      }
    });
  }

  // Initial Load Filter from URL
  const urlParams = new URLSearchParams(window.location.search);
  const initialFilter = urlParams.get('filter') || 'all';
  document.querySelector(`[data-filter="${initialFilter}"]`).classList.add('active');
  filterProjects(initialFilter);

  // Mode Toggle
  document.getElementById('modeToggle').addEventListener('click', () => {
    document.body.classList.toggle('dark-mode');
    document.body.classList.toggle('light-mode');
    document.cookie = `mode=${document.body.classList.contains('dark-mode') ? 'dark' : 'light'}; path=/`;
  });
</script>

{% endblock %}